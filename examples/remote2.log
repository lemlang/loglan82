program remote;

unit Wiadomosc: class;
  var tznak:arrayof char, znak:char, rozmiar:integer;

end Wiadomosc;

unit MyProcess:process(n:integer);
var koniec:boolean;
  unit Destroy:procedure;
  begin
  write("Destroy called");
    koniec:=TRUE;
  end Destroy;


  unit WriteWiadomosc:procedure(a:Wiadomosc);
  begin
    write("przyszla wiadomosc: ");
     writeln(a.znak);
  end WriteWiadomosc;

begin
koniec:=FALSE;
 enable Destroy;
writeln("READY");
return;
while not koniec do
accept WriteWiadomosc;
od;
writeln;
writeln("END");

end MyProcess;

var p:MyProcess,i,j:integer,w:Wiadomosc,pr:arrayof MyProcess;
begin
  pref IIUWGRAPH block
  begin
  array pr dim(2:4);
  p:=new MyProcess(2);
    pr(3):=p;
    p:=new MyProcess(2);
    pr(2):=p;
    p:=new MyProcess(2);
    pr(4):=p;
    resume(pr(2));
    resume(pr(3));
    resume(pr(4));
    i:=inkey;
    while i<>ord('q') do
      if i<>0 then
         w := new Wiadomosc;
         w.znak := chr(i);
         call pr(2).WriteWiadomosc(w);
         call pr(3).WriteWiadomosc(w);
         call pr(4).WriteWiadomosc(w);
         writeln(w.znak);
      fi;

      i:=inkey;
    od;

    writeln;
    writeln("p.Destroy");
    call pr(2).Destroy;
    call pr(3).Destroy;
    call pr(4).Destroy;
    writeln("p.Destroyed :D");
  end;
end.
