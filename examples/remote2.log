program remote;

unit Wiadomosc: class;
  var tznak:arrayof char, znak:char, rozmiar:integer;

end Wiadomosc;

unit MyProcess:process(n:integer);
var koniec:boolean;
  unit Destroy:procedure;
  begin
  write("Destroy called");
    koniec:=TRUE;
  end Destroy;


  unit WriteWiadomosc:procedure(a:Wiadomosc);
  begin
    write("przyszla wiadomosc: ");
     writeln(a.znak);
  end WriteWiadomosc;

begin
koniec:=FALSE;
 enable Destroy;
writeln("READY");
return;
while not koniec do
accept WriteWiadomosc;
od;
writeln;
writeln("END");

end MyProcess;

var p:MyProcess,i:integer,w:Wiadomosc;
begin
  pref IIUWGRAPH block
  begin
    p:=new MyProcess(2);
    resume(p);
    i:=inkey;
    while i<>ord('q') do
      if i<>0 then
         w := new Wiadomosc;
         w.znak := chr(i);
         call p.WriteWiadomosc(w);
         writeln(w.znak);
      fi;

      i:=inkey;
    od;

    writeln;
    writeln("p.Destroy");
    call p.Destroy;
    writeln("p.Destroyed :D");
  end;
end.
